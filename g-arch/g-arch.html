<!DOCTYPE html>

<title>G-Arch</title>

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="/main.css" rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script async src="g-arch.js" type="application/javascript"></script>
</head>

<body>
    <div class="sticky-top" style="background-color: var(--theme-color3)">
        <h1>Game ARCHitecture (G-ARCH)</h1>
        <ul class="nav nav-tabs nav-fill" id="myTabs" role="tablist" style="background-color: var(--theme-color3)">
            <li class="nav-item">
                <a class="nav-link active" id="about-tab" data-toggle="tab" href="#about-data" role="tab" aria-controls="about-data" aria-selected="true">About</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="components-tab" data-toggle="tab" href="#components-data" role="tab" aria-controls="components-data" aria-selected="true">Components</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="families-tab" data-toggle="tab" href="#families-data" role="tab" aria-controls="families-data" aria-selected="false">Families</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="entities-tab" data-toggle="tab" href="#entities-data" role="tab" aria-controls="entities-data" aria-selected="false">Entities</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="systems-tab" data-toggle="tab" href="#system-data" role="tab" aria-controls="system-data" aria-selected="false">Systems</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="json-tab" data-toggle="tab" href="#json-data" role="tab" aria-controls="json-data" aria-selected="false">Json</a>
            </li>
        </ul>
    </div>
    <div class='tab-content'>
        <div class='tab-pane fade show active' id='about-data' role="tabpanel" aria-labelledby="about-tab" style="background-color: var(--theme-color1)">
            <h2>G-Arch is a tool designed to help aid in game architecture structure. This tool assumes that an entity component system will be used.</h2>
            <hr class="my-4">
            <div class="row">
                <div class='col-md-auto'>
                    <h2 class='display-5'>How to use</h2>
                    <ul class="nav nav-tabs nav-justified flex-column" id="myTabs2" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="components-help-tab" data-toggle="tab" href="#components-help" role="tab" aria-controls="components-help" aria-selected="true">Components</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="families-help-tab" data-toggle="tab" href="#families-help" role="tab" aria-controls="families-help" aria-selected="false">Families</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="entities-help-tab" data-toggle="tab" href="#entities-help" role="tab" aria-controls="entities-help" aria-selected="false">Entities</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="systems-help-tab" data-toggle="tab" href="#systems-help" role="tab" aria-controls="systems-help" aria-selected="false">Systems</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="json-example-help-tab" data-toggle="tab" href="#json-example-help" role="tab" aria-controls="json-example-help" aria-selected="false">Json Example</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="yaml-example-help-tab" data-toggle="tab" href="#yaml-example-help" role="tab" aria-controls="yaml-example-help" aria-selected="false">YAML Example</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="="true" aria-expanded="false">Code Generation Examples</a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" id="csharp-example-tab" data-toggle="tab" href="#csharp-example-help" aria-controls="csharp-example-help" aria-selected="false" href="">C#</a>
                                <a class="dropdown-item" href="">TypeScript</a>
                                <a class="dropdown-item" href="">Rust</a>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class='tab-content col'>
                    <div class='tab-pane fade active show' id='components-help' role='tabpanel' aria-labelledby="components-help-tab">
                        <p class="lead">A component is a set of data.</p>
                        <p>Example: A position component that represents an entity's position a 2D game will have two numbers to represent the X and Y coordinate.</p>

                        <p>JSON Example</p>
                        <pre class="jsonExample">
                            {
                                "name" : "position",
                                "properties": [
                                    {
                                        "name": "x",
                                        "type" : "float"
                                    },
                                    {
                                        "name" : "y",
                                        "type" : "float"
                                    }
                                ]
                            }
                        </pre>

                        <p>YAML Example</p>
                        <pre class="yamlExample">
                            name: position
                            properties:
                            - 
                                name: x
                                type : float
                            - 
                                name : y
                                type : float
                        </pre>
                    </div>
                    <div class='tab-pane fade' id='families-help' role='tabpanel' aria-labelledby="families-help-tab">
                        <p class="lead">A family is a set of components. If an entity belongs to a family, then it must have all of the components in the set.</p>
                        <p>Example: Members of the 'movable' family will have a position component and a velocity component</p>

                        <p>JSON Example</p>
                        <pre class="jsonExample">
                            {
                                "name" : "movable",
                                "components": [
                                    "position",
                                    "velocity"
                                ]
                            }
                        </pre>

                        <p>YAML Example</p>
                        <pre class="yamlExample">
                            name : movable
                            components:
                                - position
                                - velocity
                        </pre>
                    </div>
                    <div class='tab-pane fade' id='entities-help' role='tabpanel' aria-labelledby="entities-help-tab">
                        <p class="lead">An entity is a set of components that belongs to one or more families. The families that the entity belongs to defines which components it has.</p>
                        <p>Example: The 'player' entity is a member of the 'movable', 'controllable', and 'drawable' families.</p>

                        <p>JSON Example</p>
                        <pre class="jsonExample">
                            {
                                "name" : "player",
                                "families": [
                                    "movable",
                                    "controllable",
                                    "drawable"
                                ]
                            }
                        </pre>

                        <p>YAML Example</p>
                        <pre class="yamlExample">
                            name : player
                            families:
                                - movable
                                - controllable
                                - drawable
                        </pre>
                    </div>
                    <div class='tab-pane fade' id='systems-help' role='tabpanel' aria-labelledby="systems-help-tab">
                        <p class="lead">A system is a function that takes a game state and returns a game state modification. The call order is dependent on the position it is in the array.</p>
                        <p>NOTE: If using parallel code generation, order doesn't matter</p>

                        <p>JSON Example</p>
                        <pre class="jsonExample">
                            [
                                "controlPlayer",
                                "movePlayer",
                                "drawPlayer"
                            ]
                        </pre>

                        <p>YAML Example</p>
                        <pre class="yamlExample">
                            - controlPlayer
                            - movePlayer
                            - drawPlayer
                        </pre>
                    </div>
                    <div class='tab-pane fade' id='json-example-help' role='tabpanel' aria-labelledby="json-example-help-tab">
                        <pre class="jsonExample" id="fullJsonExample"></pre>
                    </div>
                    <div class='tab-pane fade' id='yaml-example-help' role='tabpanel' aria-labelledby="yaml-example-help'">
                        <pre class="yamlExample" id="fullYamlExample"></pre>
                    </div>
                    <div class="tab-pane fade" id="csharp-example-help" role="tabpanel" aria-labelledby="csharp-example-help">
                        <h1>C#</h1>
<h4>Components are structs</h4>
<pre class="jsonExample col-md-auto">
public struct Position {
    public readonly float x;
    public readonly float y;

    public Position(float x, float y) {
        this.x = x;
        this.y = y;
    }
}
public struct Velocity {
    public readonly float x;
    public readonly float y;

    public Velocity(float x, float y) {
        this.x = x;
        this.y = y;
    }
}
public struct Controller {
    public readonly string controllerType;

    public Controller(string contorllerType) {
        this.controllerType = contorllerType;
    }
}
public struct Texture{
    public readonly string textureFilePath;

    public Texture(string textureFilePath) {
        this.textureFilePath = textureFilePath;
    }
}
</pre>
<h4>Families are interfaces</h4>
<pre class="jsonExample col-md-auto">
public interface Movable {
    public Position Position {get;}
    public Velocity velocity {get;}
}
public interface Drawable {
    public Position position {get;}
    public Texture texture {get;}
}
public interface Controllable {
    public Velocity Velocity {get;}
    public Controller Controller {get;}
}
</pre>
<h4>Entities are classes</h4>
<pre class="jsonExample col-md-auto">
public class Player : Movable, Drawable, Controllable {
    public readonly Position position;
    public readonly Velocity velocity;
    public readonly Texture texture;
    public readonly Controller controller;

    public Player(Position position, Velocity velocity, Texture texture, Controller controller){
        this.position = position;
        this.velocity = velocity;
        this.texture = texture;
        this.controller = controller;
    }
}
</pre>
<h4>Systems are just functions that take a GameState and return a GameStateModifier. System manager will contain all of the systems.</h4>
<pre class="jsonExample col-md-auto">
// Synchrounous
public interface SystemManagerImpl {
    // A system is a function.
    GameStateModifidier ControlPlayer(IReadOnlyGameState gameState);
    GameStateModifidier MovePlayer(IReadOnlyGameState gameState);
    GameStateModifidier DrawPlayer(IReadOnlyGameState gameState);
}
public class SystemManager {
    private readonly SystemManagerImpl _impl;

    public SystemManager(SystemManagerImpl impl) {
        _impl = impl;
    }

    public GameState Update(IReadOnlyGameState gameState) {
        return gameState + GetModifications(gameState);
    }

    public IEnumerable&ltGameStateModifidier&gt GetModifications(IReadOnlyGameState gameState){
        yield return _impl.ControlPlayer(gameState); 
        yield return _impl.MovePlayer(gameState);
        yield return _impl.DrawPlayer(gameState);
    }    
}
// Asynchronous
public interface AsyncSystemManagerImpl {
    // A system is a function.
    Task&ltIEnumerable&ltGameStateModifidier&gt&gt ControlPlayer(IReadOnlyGameState gameState);
    Task&ltIEnumerable&ltGameStateModifidier&gt&gt MovePlayer(IReadOnlyGameState gameState);
    Task&ltIEnumerable&ltGameStateModifidier&gt&gt DrawPlayer(IReadOnlyGameState gameState);
}
</pre>
<h4>Other created structures</h4>
<pre class="jsonExample col-md-auto">
// Game State
// 1. Every family will have a list defined.
// 2. Every entity will have a map defined.
// 3. Every system will have a system state associated with it.
public class GameState : IReadOnlyGameState {
    // Data
    private float delta = 0;
    private ulong frame = 0;

    // Families
    private List&ltMovable&gt movables = new List&ltMovable&gt();
    private List&ltDrawable&gt drawables = new Lust&ltDrawable&gt();
    private List&ltControllable&gt controllables = new List&ltControllable&gt();

    // Entities
    private Dictionary&ltint,Player&gt players = new Dictionary&ltint,Player&gt();

    // IReadOnlyGameState
    public float Delta => delta;
    public ulong Frame => frame;
    public IReadOnlyList&ltMovable&gt Movables => movables;
    public IReadOnlyList&ltDrawable&gt Drawables => drawables;
    public IReadOnlyList&ltControllable&gt Controllable => controllable;
    public Dictionary&l&ltint,tPlayer&gt&gt Players{get;}
    
    // System States
    public readonly SystemState MovePlayerState, DrawPlayerState, ControlPlayerState;

    public void AddPlayer(Player player) {
        players.Add(player.GetHashCode(), player);
        movables.Add(player);
        drawables.Add(player);
        controllables.Add(player);
    }

    public static GameState operator+(IEnumerable&ltGameStateModifier&gt mods) {
        GameState newState;
        newState.players = this.Players.Clone();
        foreach(var mod in mods)
        {
            foreach(var player in mod.PlayersToAdd)
            {
                newState.players.Add(player.GetHashCode(), player);
            }
            foreach(var playerToRemove in mod.PlayersToRemove)
            {
                newState.players.Remove(playerToRemove);
            }
        }
        return newState;
    }
}

public interface IReadOnlyGameState {
    // Data
    public float Delta {get;}
    public ulong Frame{get;}

    // Families
    public IReadOnlyList&ltMovable&gt Movables{get;}
    public IReadOnlyList&ltDrawable&gt Drawables{get;}
    public IReadOnlyList&ltControllable&gt Controllers{get;}

    // Entities
    public Dictionary&l&ltint,tPlayer&gt&gt Players{get;}
}

// Game State GameStateModifier
// 1. Every family
public struct GameStateModifidier {
    public IEnumerable&ltPlayer&gt PlayersToAdd{get;}
    public IEnumerable&ltint&gt PlayersToRemove{get;}

    public IEnumerable&ltTuple&ltint,Position&gt&gt PositionChanges{get;}
    public IEnumerable&ltTuple&ltint,Velocity&gt&gt VelocityChanges{get;}
    public IEnumerable&ltTuple&ltint,Controller&gt&gt ControllerChanges{get;}
    public IEnumerable&ltTuple&ltint,Texture&gt&gt TextureChanges{get;}
}

// A enum will be created and passed to every system function.
public enum SystemState {
    On,
    Off
}
</pre>
                    </div>
                </div>
            </div>
        </div>
        <div class='tab-pane fade' id="components-data" role="tabpanel" aria-labelledby="components-tab">
            <div id="components-list"></div>
            <button class="btn btn-temware" type="button" id="components-button" style="background-color: var(--theme-color9)">Add Component</button>
        </div>
        <div class='tab-pane fade' id="families-data" role="tabpanel" aria-labelledby="families-data">
            <div id="families-list"></div>
            <button class="btn btn-temware" type="button" id="families-button" style="background-color: var(--theme-color8)">Add Family</button>
        </div>
        <div class='tab-pane fade' id="entities-data" role="tabpanel" aria-labelledby="entities-data">
            <div id="entities-list"></div>
            <button class="btn btn-temware" type="button" id="entities-button" style="background-color: var(--theme-color9)">Add Entity</button>
        </div>
        <div class='tab-pane fade' id="system-data" role="tabpanel" aria-labelledby="systems-data">
            <div id="systems-list"></div>
            <button class="btn btn-temware" type="button" id="systems-button" style="background-color: var(--theme-color8)">Add System</button>
        </div>
        <div class='tab-pane fade' id='json-data' role="tabpanel" aria-labelledby="json-data">
            <pre readonly id='json-content'>{}</pre>
        </div>
    </div>
</body>
</html>